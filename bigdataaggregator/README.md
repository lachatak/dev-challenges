## Big Data Aggregator ##

This is my solution for **Dev Challenges** series [Big Data Aggregator](CHALLENGE.md) section.
There are 2 different implementations under the hood to be able to compare solutions.

## How to run ##
```
sbt clean assembly
java -jar -Dapp.type=stream -Dpartner=KRS -Dcurrency=GBP -Dtransactions=transactions.csv -Dexchange.rates=exchangerates.csv -Daggregates=aggregate.csv target/scala-2.11/bigdataaggregator.jar
```
Any of the parameters can abe omitted. They will be defaulted from the [application.conf](src/main/resources/application.conf).

#### Application types ####
- stream. Uses simple scala file streams
- spark. Uses spark to process the provided transactions.csv file. This is the default application type

### Results with streams ###
- 10 randomly generated partner names in the transactions.csv file + 1 for validation which is my name "KRS"
- 10 cross exchange rates -> 90 items in the currencies.csv file
- 100.000.000 generated transactions for 10 partners and 10 currencies
```
krisztian.lachata@GL05152M:bigdataaggregator [master]$ java -jar -Dapp.type=stream target/scala-2.11/bigdataaggregator.jar
Start processing with app type stream, partner=KRS, currency=GBP, transactions=transactions.csv, exchangerates=exchangerates.csv aggregates=aggregate.csv ...
Some(Map(kvCtf -> 19456075.501631942937, 84XSG -> 19488248.263553848854, qi6Hc -> 19492225.115326444952, r8qKz -> 19459951.009410141564, TMXpD -> 19466082.416503638715, EN7hG -> 19464775.151915200189, XHcZe -> 19429927.173705586060, 08iAY -> 19392243.676701102815, pfyFA -> 19455178.142609856951, QtLox -> 19466843.225232753644, eUvHO -> 19437235.899645089228, JO1p4 -> 19443708.896395232624, FCaXo -> 19427441.731190999901, rsgN7 -> 19445507.795439044373, vtkcR -> 19431000.792293517538, hhqp3 -> 19461153.469744267264, UtwyW -> 19460700.734213058482, shqzi -> 19491333.715106893823, 530P2 -> 19461245.702722894117, OZ0tb -> 19471074.057391247356, 91x1k -> 19490718.355352542853, JOyiZ -> 19432438.230310781520, MRN8w -> 19490931.387445072618, rQdjW -> 19474633.902410825717, uR7jp -> 19430191.652983282987, 68pGf -> 19469474.222706490176, wobBE -> 19440470.885319285918, gCh3w -> 19432319.217145838323, Mu9Ce -> 19510974.549254643718, 8Hlyj -> 19488245.761576966695, a35MD -> 19460011.481173419382, nsFM9 -> 19451390.002654952329, vd9cR -> 19409788.635061284903, DIw9G -> 19471768.905809726142, Q1fUm -> 19440136.546757102626, BBPqi -> 19497240.297443401565, lRyHH -> 19425868.674715787577, iqXcM -> 19392993.958386165636, U8bmw -> 19404057.181602679873, M6snO -> 19458990.204895520629, CgxnK -> 19480629.719945818230, xiFHy -> 19503290.485043408574, KRS -> 19434179.159068126380, 5YqFC -> 19443619.554245639633, iCIuj -> 19462150.401078810853, eRpyG -> 19419841.956112750150, ut5GB -> 19438442.261247477159, HRnJr -> 19407922.594219699852, 1vA7V -> 19505284.731010949101, nHiWG -> 19452634.131311875580, KqKQe -> 19467118.931476568364, tlKtL -> 19437540.147241446845, uO7A7 -> 19497716.434285033004, U6Vcy -> 19427316.626774469952, 39po9 -> 19452832.966160454591, di8sB -> 19440202.280225086904, 16Q6D -> 19475608.763583130099, zB2au -> 19432220.924148579127, mkVco -> 19455644.611522252740, 3uCYX -> 19490534.343861210719, LNNY3 -> 19380220.870118988994, bBm0d -> 19517809.255997491554, tast1 -> 19453650.959837063470, 03tbg -> 19498631.645082682505, zZkSZ -> 19442605.471475052137, VFS4X -> 19472163.065169511392, Q3ZhB -> 19463004.110407697020, Qf3Cy -> 19474240.442491599075, pVn0h -> 19418146.075936525579, OGVat -> 19437554.565143150968, BXBS4 -> 19451772.167457488235, tiVSo -> 19433157.289460604736, bzeXZ -> 19428031.064214172516, 3Bz48 -> 19419026.866644131156, 7crQg -> 19446597.308789322761, xIjH0 -> 19435726.642436690077, iLjPz -> 19437184.655877115304, pDxde -> 19401187.179900891396, U1w1S -> 19485319.982860740163, 5lCDy -> 19481860.733261962619, QyH1m -> 19435043.987775581000, gbnkU -> 19470524.030234750676, hsIoU -> 19464952.090490854331, cuib6 -> 19486880.385892458593, kW8KW -> 19480140.753016355812, sHszy -> 19480928.719489332456, 6pXNB -> 19511268.063532292195, HX2L7 -> 19449629.525667546893, HDxfE -> 19460606.971057489184, J9Oa6 -> 19493342.841669497278, wiBf8 -> 19467754.366505469076, YWZTW -> 19473758.117167240773, 5IZDC -> 19481579.561814102709, w13TO -> 19423874.113806456622, hA1k9 -> 19404793.386020016456, uvd9c -> 19486792.906914097471, b0Opp -> 19405408.792506059497, RhDZx -> 19387438.628266188620, GVSGa -> 19475720.297605017566, iQzVT -> 19421857.617281751021))
Process time from file -> result to file : 88.078s
19434179.159068126380
Process time form file -> result to console : 44.855s
```

### Results with Spark ###
- 10 randomly generated partner names in the transactions.csv file + 1 for validation which is my name "KRS"
- 10 cross exchange rates -> 90 items in the currencies.csv file
- 100.000.000 generated transactions for 10 partners and 10 currencies
```
krisztian.lachata@GL05152M:bigdataaggregator [master]$ java -jar -Dapp.type=spark target/scala-2.11/bigdataaggregator.jar
Start processing with app type stream, partner=KRS, currency=GBP, transactions=transactions.csv, exchangerates=exchangerates.csv aggregates=aggregate.csv ...
Some(Map(kvCtf -> 19456075.501631942937, 84XSG -> 19488248.263553848854, qi6Hc -> 19492225.115326444952, r8qKz -> 19459951.009410141564, TMXpD -> 19466082.416503638715, EN7hG -> 19464775.151915200189, XHcZe -> 19429927.173705586060, 08iAY -> 19392243.676701102815, pfyFA -> 19455178.142609856951, QtLox -> 19466843.225232753644, eUvHO -> 19437235.899645089228, JO1p4 -> 19443708.896395232624, FCaXo -> 19427441.731190999901, rsgN7 -> 19445507.795439044373, vtkcR -> 19431000.792293517538, hhqp3 -> 19461153.469744267264, UtwyW -> 19460700.734213058482, shqzi -> 19491333.715106893823, 530P2 -> 19461245.702722894117, OZ0tb -> 19471074.057391247356, 91x1k -> 19490718.355352542853, JOyiZ -> 19432438.230310781520, MRN8w -> 19490931.387445072618, rQdjW -> 19474633.902410825717, uR7jp -> 19430191.652983282987, 68pGf -> 19469474.222706490176, wobBE -> 19440470.885319285918, gCh3w -> 19432319.217145838323, Mu9Ce -> 19510974.549254643718, 8Hlyj -> 19488245.761576966695, a35MD -> 19460011.481173419382, nsFM9 -> 19451390.002654952329, vd9cR -> 19409788.635061284903, DIw9G -> 19471768.905809726142, Q1fUm -> 19440136.546757102626, BBPqi -> 19497240.297443401565, lRyHH -> 19425868.674715787577, iqXcM -> 19392993.958386165636, U8bmw -> 19404057.181602679873, M6snO -> 19458990.204895520629, CgxnK -> 19480629.719945818230, xiFHy -> 19503290.485043408574, KRS -> 19434179.159068126380, 5YqFC -> 19443619.554245639633, iCIuj -> 19462150.401078810853, eRpyG -> 19419841.956112750150, ut5GB -> 19438442.261247477159, HRnJr -> 19407922.594219699852, 1vA7V -> 19505284.731010949101, nHiWG -> 19452634.131311875580, KqKQe -> 19467118.931476568364, tlKtL -> 19437540.147241446845, uO7A7 -> 19497716.434285033004, U6Vcy -> 19427316.626774469952, 39po9 -> 19452832.966160454591, di8sB -> 19440202.280225086904, 16Q6D -> 19475608.763583130099, zB2au -> 19432220.924148579127, mkVco -> 19455644.611522252740, 3uCYX -> 19490534.343861210719, LNNY3 -> 19380220.870118988994, bBm0d -> 19517809.255997491554, tast1 -> 19453650.959837063470, 03tbg -> 19498631.645082682505, zZkSZ -> 19442605.471475052137, VFS4X -> 19472163.065169511392, Q3ZhB -> 19463004.110407697020, Qf3Cy -> 19474240.442491599075, pVn0h -> 19418146.075936525579, OGVat -> 19437554.565143150968, BXBS4 -> 19451772.167457488235, tiVSo -> 19433157.289460604736, bzeXZ -> 19428031.064214172516, 3Bz48 -> 19419026.866644131156, 7crQg -> 19446597.308789322761, xIjH0 -> 19435726.642436690077, iLjPz -> 19437184.655877115304, pDxde -> 19401187.179900891396, U1w1S -> 19485319.982860740163, 5lCDy -> 19481860.733261962619, QyH1m -> 19435043.987775581000, gbnkU -> 19470524.030234750676, hsIoU -> 19464952.090490854331, cuib6 -> 19486880.385892458593, kW8KW -> 19480140.753016355812, sHszy -> 19480928.719489332456, 6pXNB -> 19511268.063532292195, HX2L7 -> 19449629.525667546893, HDxfE -> 19460606.971057489184, J9Oa6 -> 19493342.841669497278, wiBf8 -> 19467754.366505469076, YWZTW -> 19473758.117167240773, 5IZDC -> 19481579.561814102709, w13TO -> 19423874.113806456622, hA1k9 -> 19404793.386020016456, uvd9c -> 19486792.906914097471, b0Opp -> 19405408.792506059497, RhDZx -> 19387438.628266188620, GVSGa -> 19475720.297605017566, iQzVT -> 19421857.617281751021))
Process time from file -> result to file : 25.709s
19434179.159068126380
Process time form file -> result to console : 16.662s
```
If you have a running spark cluster you could pass the URl of the master node as **-Dspark.main.host=spark://HOST:POST**. With this you could extend the processing capacity. For the tests sake it is running in embedded mode.
### Technical details ###
- scala 2.11.4
- sbt 0.13.5
- scalaz 7.1.0
- [cake pattern](http://jonasboner.com/2008/10/06/real-world-scala-dependency-injection-di/) dependency injection for scala
- [Spark](http://spark.apache.org/docs/latest/index.html) for cluster computing transaction file
- Domain Driven Design. Separated infrastructure/app/domain layers implemented in scala
- [Scala spec2](https://etorreborre.github.io/specs2/guide/SPECS2-3.5/org.specs2.guide.UserGuide.html) for testing
- Input validation. Invalid transaction or currency doesn't break the calculation
- Typesafe custom types
```scala
  type Currency = String
  type Partner = String
  type Amount = BigDecimal
  type Rate = BigDecimal
  type PartnerAmountSummary = Map[Partner, Amount]
  type ExchangeRate = ((Currency, Currency), Rate)
  type ExchangeRates = Map[(Currency, Currency), Rate]
```
